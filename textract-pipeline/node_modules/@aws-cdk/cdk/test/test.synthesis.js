"use strict";
const cxapi = require("@aws-cdk/cx-api");
const fs = require("fs");
const os = require("os");
const path = require("path");
const cdk = require("../lib");
const lib_1 = require("../lib");
const storeTestMatrix = {};
function createModernApp() {
    return new cdk.App({
        context: {
            [cxapi.DISABLE_LEGACY_MANIFEST_CONTEXT]: 'true',
            [cxapi.DISABLE_VERSION_REPORTING]: 'true',
        }
    });
}
//
// all these tests will be executed for each type of store
//
const storeTests = {
    'writeFile()/readFile()'(test, store) {
        // WHEN
        store.writeFile('bla.txt', 'hello');
        store.writeFile('hey.txt', '1234');
        // THEN
        test.deepEqual(store.readFile('bla.txt').toString(), 'hello');
        test.deepEqual(store.readFile('hey.txt').toString(), '1234');
        test.throws(() => store.writeFile('bla.txt', 'override is forbidden'));
        // WHEN
        store.lock();
        // THEN
        test.throws(() => store.writeFile('another.txt', 'locked!'));
        test.done();
    },
    'exists() for files'(test, store) {
        // WHEN
        store.writeFile('A.txt', 'aaa');
        // THEN
        test.ok(store.exists('A.txt'));
        test.ok(!store.exists('B.txt'));
        test.done();
    },
    'mkdir'(test, store) {
        // WHEN
        const dir1 = store.mkdir('dir1');
        const dir2 = store.mkdir('dir2');
        // THEN
        test.ok(fs.statSync(dir1).isDirectory());
        test.ok(fs.statSync(dir2).isDirectory());
        test.throws(() => store.mkdir('dir1'));
        // WHEN
        store.lock();
        test.throws(() => store.mkdir('dir3'));
        test.done();
    },
    'list'(test, store) {
        // WHEN
        store.mkdir('dir1');
        store.writeFile('file1.txt', 'boom1');
        // THEN
        test.deepEqual(store.list(), ['dir1', 'file1.txt']);
        test.done();
    },
    'SynthesisSession'(test, store) {
        // GIVEN
        const session = new lib_1.SynthesisSession({ store });
        const templateFile = 'foo.template.json';
        // WHEN
        session.addArtifact('my-first-artifact', {
            type: cxapi.ArtifactType.AwsCloudFormationStack,
            environment: 'aws://1222344/us-east-1',
            dependencies: ['a', 'b'],
            metadata: {
                foo: { bar: 123 }
            },
            properties: {
                templateFile,
                parameters: {
                    prop1: '1234',
                    prop2: '555'
                }
            },
            missing: {
                foo: {
                    provider: 'context-provider',
                    props: {
                        a: 'A',
                        b: 2
                    }
                }
            }
        });
        session.addArtifact('minimal-artifact', {
            type: cxapi.ArtifactType.AwsCloudFormationStack,
            environment: 'aws://111/helo-world',
            properties: {
                templateFile
            }
        });
        session.store.writeJson(templateFile, {
            Resources: {
                MyTopic: {
                    Type: 'AWS::S3::Topic'
                }
            }
        });
        session.close();
        const manifest = session.store.readJson(cxapi.MANIFEST_FILE);
        // THEN
        delete manifest.runtime; // deterministic tests
        // verify the manifest looks right
        test.deepEqual(manifest, {
            version: cxapi.PROTO_RESPONSE_VERSION,
            artifacts: {
                'my-first-artifact': {
                    type: 'aws:cloudformation:stack',
                    environment: 'aws://1222344/us-east-1',
                    dependencies: ['a', 'b'],
                    metadata: { foo: { bar: 123 } },
                    properties: {
                        templateFile: 'foo.template.json',
                        parameters: {
                            prop1: '1234',
                            prop2: '555'
                        },
                    },
                    missing: {
                        foo: { provider: 'context-provider', props: { a: 'A', b: 2 } }
                    }
                },
                'minimal-artifact': {
                    type: 'aws:cloudformation:stack',
                    environment: 'aws://111/helo-world',
                    properties: { templateFile: 'foo.template.json' }
                }
            }
        });
        // verify we have a template file
        test.deepEqual(session.store.readJson(templateFile), {
            Resources: {
                MyTopic: {
                    Type: 'AWS::S3::Topic'
                }
            }
        });
        test.done();
    },
    'stack.setParameterValue can be used to assign parameters'(test) {
        // GIVEN
        const app = createModernApp();
        const stack = new cdk.Stack(app, 'my-stack');
        const param = new cdk.CfnParameter(stack, 'MyParam', { type: 'string' });
        // WHEN
        stack.setParameterValue(param, 'Foo');
        // THEN
        const session = app.run();
        const props = (session.manifest.artifacts && session.manifest.artifacts['my-stack'].properties) || {};
        test.deepEqual(props.parameters, {
            MyParam: 'Foo'
        });
        test.done();
    },
    'addBuildStep can be used to produce build.json'(test) {
        // GIVEN
        const app = createModernApp();
        // WHEN
        class BuildMe extends cdk.Construct {
            synthesize(s) {
                s.addBuildStep('step_id', {
                    type: 'build-step-type',
                    parameters: {
                        boom: 123
                    }
                });
            }
        }
        new BuildMe(app, 'hey');
        // THEN
        const session = app.run();
        test.deepEqual(session.store.list(), ['build.json', 'manifest.json']);
        test.deepEqual(session.store.readJson('build.json'), {
            steps: {
                step_id: { type: 'build-step-type', parameters: { boom: 123 } }
            }
        });
        test.done();
    }
};
for (const [name, fn] of Object.entries(storeTests)) {
    const outdir = fs.mkdtempSync(path.join(os.tmpdir(), 'synthesis-tests'));
    const fsStore = new lib_1.FileSystemStore({ outdir });
    const memoryStore = new lib_1.InMemoryStore();
    storeTestMatrix[`FileSystemStore - ${name}`] = (test) => fn(test, fsStore);
    storeTestMatrix[`InMemoryStore - ${name}`] = (test) => fn(test, memoryStore);
}
module.exports = {
    'synthesis with an empty app'(test) {
        // GIVEN
        const app = createModernApp();
        // WHEN
        const session = app.run();
        // THEN
        test.same(app.run(), session); // same session if we run() again
        test.deepEqual(session.store.list(), ['manifest.json']);
        test.deepEqual(session.store.readJson('manifest.json').artifacts, {});
        test.done();
    },
    'single empty stack'(test) {
        // GIVEN
        const app = createModernApp();
        new cdk.Stack(app, 'one-stack');
        // WHEN
        const session = app.run();
        // THEN
        test.deepEqual(session.store.list(), [
            'manifest.json',
            'one-stack.template.json'
        ]);
        test.done();
    },
    'some random construct implements "synthesize"'(test) {
        // GIVEN
        const app = createModernApp();
        const stack = new cdk.Stack(app, 'one-stack');
        class MyConstruct extends cdk.Construct {
            synthesize(s) {
                s.store.writeJson('foo.json', { bar: 123 });
                s.addArtifact('my-random-construct', {
                    type: cxapi.ArtifactType.AwsCloudFormationStack,
                    environment: 'aws://12345/bar',
                    properties: {
                        templateFile: 'file://boom'
                    }
                });
            }
        }
        new MyConstruct(stack, 'MyConstruct');
        // WHEN
        const session = app.run();
        // THEN
        test.deepEqual(session.store.list(), [
            'foo.json',
            'manifest.json',
            'one-stack.template.json'
        ]);
        test.deepEqual(session.store.readJson('foo.json'), { bar: 123 });
        test.deepEqual(session.manifest, {
            version: '0.19.0',
            artifacts: {
                'my-random-construct': {
                    type: 'aws:cloudformation:stack',
                    environment: 'aws://12345/bar',
                    properties: { templateFile: 'file://boom' }
                },
                'one-stack': {
                    type: 'aws:cloudformation:stack',
                    environment: 'aws://unknown-account/unknown-region',
                    properties: { templateFile: 'one-stack.template.json' },
                }
            },
        });
        test.done();
    },
    'backwards compatibility: cdk.out contains all synthesized stacks'(test) {
        // GIVEN
        const app = new cdk.App();
        const stack1 = new cdk.Stack(app, 'stack1');
        new cdk.CfnResource(stack1, 'Resource1', { type: 'AWS::CDK::Resource' });
        new cdk.CfnResource(stack1, 'Resource2', { type: 'AWS::CDK::Resource' });
        const stack2 = new cdk.Stack(app, 'stack2');
        new cdk.CfnResource(stack2, 'ResourceA', { type: 'AWS::CDK::Resource' });
        // WHEN
        const session = app.run();
        const legacy = session.store.readJson(cxapi.OUTFILE_NAME);
        // THEN
        const t1 = legacy.stacks.find(s => s.name === 'stack1').template;
        const t2 = legacy.stacks.find(s => s.name === 'stack2').template;
        test.deepEqual(t1, {
            Resources: {
                Resource1: { Type: 'AWS::CDK::Resource' },
                Resource2: { Type: 'AWS::CDK::Resource' }
            }
        });
        test.deepEqual(t2, {
            Resources: {
                ResourceA: { Type: 'AWS::CDK::Resource' }
            }
        });
        test.done();
    },
    'it should be possible to synthesize without an app'(test) {
        const calls = new Array();
        class SynthesizeMe extends lib_1.Construct {
            constructor() {
                super(undefined, 'id');
            }
            validate() {
                calls.push('validate');
                return [];
            }
            prepare() {
                calls.push('prepare');
            }
            synthesize(session) {
                calls.push('synthesize');
                session.addArtifact('art', {
                    type: cxapi.ArtifactType.AwsEcrDockerImage,
                    environment: 'aws://unknown-account/us-east-1'
                });
                session.store.writeJson('hey.json', { hello: 123 });
            }
        }
        const root = new SynthesizeMe();
        const synth = new lib_1.Synthesizer();
        const result = synth.synthesize(root);
        test.deepEqual(calls, ['prepare', 'validate', 'synthesize']);
        test.deepEqual(result.store.readJson('hey.json'), { hello: 123 });
        test.deepEqual(result.manifest.artifacts.art, {
            type: 'aws:ecr:image',
            environment: 'aws://unknown-account/us-east-1'
        });
        test.done();
    },
    'store': storeTestMatrix
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC5zeW50aGVzaXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ0ZXN0LnN5bnRoZXNpcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEseUNBQTBDO0FBQzFDLHlCQUEwQjtBQUUxQix5QkFBMEI7QUFDMUIsNkJBQThCO0FBQzlCLDhCQUErQjtBQUMvQixnQ0FBcUg7QUFFckgsTUFBTSxlQUFlLEdBQVEsRUFBRSxDQUFDO0FBRWhDLFNBQVMsZUFBZTtJQUN0QixPQUFPLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQztRQUNqQixPQUFPLEVBQUU7WUFDUCxDQUFDLEtBQUssQ0FBQywrQkFBK0IsQ0FBQyxFQUFFLE1BQU07WUFDL0MsQ0FBQyxLQUFLLENBQUMseUJBQXlCLENBQUMsRUFBRSxNQUFNO1NBQzFDO0tBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQThKRCxFQUFFO0FBQ0YsMERBQTBEO0FBQzFELEVBQUU7QUFDRixNQUFNLFVBQVUsR0FBRztJQUNqQix3QkFBd0IsQ0FBQyxJQUFVLEVBQUUsS0FBd0I7UUFDM0QsT0FBTztRQUNQLEtBQUssQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3BDLEtBQUssQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRW5DLE9BQU87UUFDUCxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDOUQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQzdELElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxTQUFTLEVBQUUsdUJBQXVCLENBQUMsQ0FBQyxDQUFDO1FBRXZFLE9BQU87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RUFBRSxDQUFDLENBQUM7UUFDbEUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDN0MsSUFBSSxFQUFFLGVBQWU7WUFDckIsV0FBVyxFQUFFLGlDQUFpQztTQUMvQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDZCxDQUFDO0lBRUQsT0FBTyxFQUFFLGVBQWU7Q0FDekIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjeGFwaSA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2N4LWFwaScpO1xuaW1wb3J0IGZzID0gcmVxdWlyZSgnZnMnKTtcbmltcG9ydCB7IFRlc3QgfSBmcm9tICdub2RldW5pdCc7XG5pbXBvcnQgb3MgPSByZXF1aXJlKCdvcycpO1xuaW1wb3J0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5pbXBvcnQgY2RrID0gcmVxdWlyZSgnLi4vbGliJyk7XG5pbXBvcnQgeyBDb25zdHJ1Y3QsIEZpbGVTeXN0ZW1TdG9yZSwgSW5NZW1vcnlTdG9yZSwgSVN5bnRoZXNpc1Nlc3Npb24sIFN5bnRoZXNpc1Nlc3Npb24sIFN5bnRoZXNpemVyIH0gZnJvbSAnLi4vbGliJztcblxuY29uc3Qgc3RvcmVUZXN0TWF0cml4OiBhbnkgPSB7fTtcblxuZnVuY3Rpb24gY3JlYXRlTW9kZXJuQXBwKCkge1xuICByZXR1cm4gbmV3IGNkay5BcHAoe1xuICAgIGNvbnRleHQ6IHtcbiAgICAgIFtjeGFwaS5ESVNBQkxFX0xFR0FDWV9NQU5JRkVTVF9DT05URVhUXTogJ3RydWUnLFxuICAgICAgW2N4YXBpLkRJU0FCTEVfVkVSU0lPTl9SRVBPUlRJTkddOiAndHJ1ZScsIC8vIGZvciB0ZXN0IHJlcHJvZHVjaWJpbGl0eVxuICAgIH1cbiAgfSk7XG59XG5cbmV4cG9ydCA9IHtcbiAgJ3N5bnRoZXNpcyB3aXRoIGFuIGVtcHR5IGFwcCcodGVzdDogVGVzdCkge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgYXBwID0gY3JlYXRlTW9kZXJuQXBwKCk7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGFwcC5ydW4oKTtcblxuICAgIC8vIFRIRU5cbiAgICB0ZXN0LnNhbWUoYXBwLnJ1bigpLCBzZXNzaW9uKTsgLy8gc2FtZSBzZXNzaW9uIGlmIHdlIHJ1bigpIGFnYWluXG4gICAgdGVzdC5kZWVwRXF1YWwoc2Vzc2lvbi5zdG9yZS5saXN0KCksIFsgJ21hbmlmZXN0Lmpzb24nIF0pO1xuICAgIHRlc3QuZGVlcEVxdWFsKHNlc3Npb24uc3RvcmUucmVhZEpzb24oJ21hbmlmZXN0Lmpzb24nKS5hcnRpZmFjdHMsIHt9KTtcbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnc2luZ2xlIGVtcHR5IHN0YWNrJyh0ZXN0OiBUZXN0KSB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBhcHAgPSBjcmVhdGVNb2Rlcm5BcHAoKTtcbiAgICBuZXcgY2RrLlN0YWNrKGFwcCwgJ29uZS1zdGFjaycpO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHNlc3Npb24gPSBhcHAucnVuKCk7XG5cbiAgICAvLyBUSEVOXG4gICAgdGVzdC5kZWVwRXF1YWwoc2Vzc2lvbi5zdG9yZS5saXN0KCksIFtcbiAgICAgICdtYW5pZmVzdC5qc29uJyxcbiAgICAgICdvbmUtc3RhY2sudGVtcGxhdGUuanNvbidcbiAgICBdKTtcbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnc29tZSByYW5kb20gY29uc3RydWN0IGltcGxlbWVudHMgXCJzeW50aGVzaXplXCInKHRlc3Q6IFRlc3QpIHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IGFwcCA9IGNyZWF0ZU1vZGVybkFwcCgpO1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjayhhcHAsICdvbmUtc3RhY2snKTtcblxuICAgIGNsYXNzIE15Q29uc3RydWN0IGV4dGVuZHMgY2RrLkNvbnN0cnVjdCBpbXBsZW1lbnRzIGNkay5JU3ludGhlc2l6YWJsZSB7XG4gICAgICBwdWJsaWMgc3ludGhlc2l6ZShzOiBjZGsuSVN5bnRoZXNpc1Nlc3Npb24pIHtcbiAgICAgICAgcy5zdG9yZS53cml0ZUpzb24oJ2Zvby5qc29uJywgeyBiYXI6IDEyMyB9KTtcbiAgICAgICAgcy5hZGRBcnRpZmFjdCgnbXktcmFuZG9tLWNvbnN0cnVjdCcsIHtcbiAgICAgICAgICB0eXBlOiBjeGFwaS5BcnRpZmFjdFR5cGUuQXdzQ2xvdWRGb3JtYXRpb25TdGFjayxcbiAgICAgICAgICBlbnZpcm9ubWVudDogJ2F3czovLzEyMzQ1L2JhcicsXG4gICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgdGVtcGxhdGVGaWxlOiAnZmlsZTovL2Jvb20nXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBuZXcgTXlDb25zdHJ1Y3Qoc3RhY2ssICdNeUNvbnN0cnVjdCcpO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHNlc3Npb24gPSBhcHAucnVuKCk7XG5cbiAgICAvLyBUSEVOXG4gICAgdGVzdC5kZWVwRXF1YWwoc2Vzc2lvbi5zdG9yZS5saXN0KCksIFtcbiAgICAgICdmb28uanNvbicsXG4gICAgICAnbWFuaWZlc3QuanNvbicsXG4gICAgICAnb25lLXN0YWNrLnRlbXBsYXRlLmpzb24nXG4gICAgXSk7XG4gICAgdGVzdC5kZWVwRXF1YWwoc2Vzc2lvbi5zdG9yZS5yZWFkSnNvbignZm9vLmpzb24nKSwgeyBiYXI6IDEyMyB9KTtcbiAgICB0ZXN0LmRlZXBFcXVhbChzZXNzaW9uLm1hbmlmZXN0LCB7XG4gICAgICB2ZXJzaW9uOiAnMC4xOS4wJyxcbiAgICAgIGFydGlmYWN0czoge1xuICAgICAgICAnbXktcmFuZG9tLWNvbnN0cnVjdCc6IHtcbiAgICAgICAgICB0eXBlOiAnYXdzOmNsb3VkZm9ybWF0aW9uOnN0YWNrJyxcbiAgICAgICAgICBlbnZpcm9ubWVudDogJ2F3czovLzEyMzQ1L2JhcicsXG4gICAgICAgICAgcHJvcGVydGllczogeyB0ZW1wbGF0ZUZpbGU6ICdmaWxlOi8vYm9vbScgfVxuICAgICAgICB9LFxuICAgICAgICAnb25lLXN0YWNrJzoge1xuICAgICAgICAgIHR5cGU6ICdhd3M6Y2xvdWRmb3JtYXRpb246c3RhY2snLFxuICAgICAgICAgIGVudmlyb25tZW50OiAnYXdzOi8vdW5rbm93bi1hY2NvdW50L3Vua25vd24tcmVnaW9uJyxcbiAgICAgICAgICBwcm9wZXJ0aWVzOiB7IHRlbXBsYXRlRmlsZTogJ29uZS1zdGFjay50ZW1wbGF0ZS5qc29uJyB9LFxuICAgICAgICB9XG4gICAgICB9LFxuICAgIH0pO1xuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdiYWNrd2FyZHMgY29tcGF0aWJpbGl0eTogY2RrLm91dCBjb250YWlucyBhbGwgc3ludGhlc2l6ZWQgc3RhY2tzJyh0ZXN0OiBUZXN0KSB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBhcHAgPSBuZXcgY2RrLkFwcCgpO1xuICAgIGNvbnN0IHN0YWNrMSA9IG5ldyBjZGsuU3RhY2soYXBwLCAnc3RhY2sxJyk7XG4gICAgbmV3IGNkay5DZm5SZXNvdXJjZShzdGFjazEsICdSZXNvdXJjZTEnLCB7IHR5cGU6ICdBV1M6OkNESzo6UmVzb3VyY2UnIH0pO1xuICAgIG5ldyBjZGsuQ2ZuUmVzb3VyY2Uoc3RhY2sxLCAnUmVzb3VyY2UyJywgeyB0eXBlOiAnQVdTOjpDREs6OlJlc291cmNlJyB9KTtcbiAgICBjb25zdCBzdGFjazIgPSBuZXcgY2RrLlN0YWNrKGFwcCwgJ3N0YWNrMicpO1xuICAgIG5ldyBjZGsuQ2ZuUmVzb3VyY2Uoc3RhY2syLCAnUmVzb3VyY2VBJywgeyB0eXBlOiAnQVdTOjpDREs6OlJlc291cmNlJyB9KTtcblxuICAgIC8vIFdIRU5cbiAgICBjb25zdCBzZXNzaW9uID0gYXBwLnJ1bigpO1xuICAgIGNvbnN0IGxlZ2FjeTogY3hhcGkuU3ludGhlc2l6ZVJlc3BvbnNlID0gc2Vzc2lvbi5zdG9yZS5yZWFkSnNvbihjeGFwaS5PVVRGSUxFX05BTUUpO1xuXG4gICAgLy8gVEhFTlxuICAgIGNvbnN0IHQxID0gbGVnYWN5LnN0YWNrcy5maW5kKHMgPT4gcy5uYW1lID09PSAnc3RhY2sxJykhLnRlbXBsYXRlO1xuICAgIGNvbnN0IHQyID0gbGVnYWN5LnN0YWNrcy5maW5kKHMgPT4gcy5uYW1lID09PSAnc3RhY2syJykhLnRlbXBsYXRlO1xuXG4gICAgdGVzdC5kZWVwRXF1YWwodDEsIHtcbiAgICAgIFJlc291cmNlczoge1xuICAgICAgICBSZXNvdXJjZTE6IHsgVHlwZTogJ0FXUzo6Q0RLOjpSZXNvdXJjZScgfSxcbiAgICAgICAgUmVzb3VyY2UyOiB7IFR5cGU6ICdBV1M6OkNESzo6UmVzb3VyY2UnIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICB0ZXN0LmRlZXBFcXVhbCh0Miwge1xuICAgICAgUmVzb3VyY2VzOiB7XG4gICAgICAgIFJlc291cmNlQTogeyBUeXBlOiAnQVdTOjpDREs6OlJlc291cmNlJyB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ2l0IHNob3VsZCBiZSBwb3NzaWJsZSB0byBzeW50aGVzaXplIHdpdGhvdXQgYW4gYXBwJyh0ZXN0OiBUZXN0KSB7XG4gICAgY29uc3QgY2FsbHMgPSBuZXcgQXJyYXk8c3RyaW5nPigpO1xuXG4gICAgY2xhc3MgU3ludGhlc2l6ZU1lIGV4dGVuZHMgQ29uc3RydWN0IHtcbiAgICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcih1bmRlZmluZWQgYXMgYW55LCAnaWQnKTtcbiAgICAgIH1cblxuICAgICAgcHJvdGVjdGVkIHZhbGlkYXRlKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgY2FsbHMucHVzaCgndmFsaWRhdGUnKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuXG4gICAgICBwcm90ZWN0ZWQgcHJlcGFyZSgpOiB2b2lkIHtcbiAgICAgICAgY2FsbHMucHVzaCgncHJlcGFyZScpO1xuICAgICAgfVxuXG4gICAgICBwcm90ZWN0ZWQgc3ludGhlc2l6ZShzZXNzaW9uOiBJU3ludGhlc2lzU2Vzc2lvbikge1xuICAgICAgICBjYWxscy5wdXNoKCdzeW50aGVzaXplJyk7XG5cbiAgICAgICAgc2Vzc2lvbi5hZGRBcnRpZmFjdCgnYXJ0Jywge1xuICAgICAgICAgIHR5cGU6IGN4YXBpLkFydGlmYWN0VHlwZS5Bd3NFY3JEb2NrZXJJbWFnZSxcbiAgICAgICAgICBlbnZpcm9ubWVudDogJ2F3czovL3Vua25vd24tYWNjb3VudC91cy1lYXN0LTEnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNlc3Npb24uc3RvcmUud3JpdGVKc29uKCdoZXkuanNvbicsIHsgaGVsbG86IDEyMyB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCByb290ID0gbmV3IFN5bnRoZXNpemVNZSgpO1xuXG4gICAgY29uc3Qgc3ludGggPSBuZXcgU3ludGhlc2l6ZXIoKTtcbiAgICBjb25zdCByZXN1bHQgPSBzeW50aC5zeW50aGVzaXplKHJvb3QpO1xuXG4gICAgdGVzdC5kZWVwRXF1YWwoY2FsbHMsIFsgJ3ByZXBhcmUnLCAndmFsaWRhdGUnLCAnc3ludGhlc2l6ZScgXSk7XG4gICAgdGVzdC5kZWVwRXF1YWwocmVzdWx0LnN0b3JlLnJlYWRKc29uKCdoZXkuanNvbicpLCB7IGhlbGxvOiAxMjMgfSk7XG4gICAgdGVzdC5kZWVwRXF1YWwocmVzdWx0Lm1hbmlmZXN0LmFydGlmYWN0cyEuYXJ0LCB7XG4gICAgICB0eXBlOiAnYXdzOmVjcjppbWFnZScsXG4gICAgICBlbnZpcm9ubWVudDogJ2F3czovL3Vua25vd24tYWNjb3VudC91cy1lYXN0LTEnXG4gICAgfSk7XG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ3N0b3JlJzogc3RvcmVUZXN0TWF0cml4XG59O1xuXG4vL1xuLy8gYWxsIHRoZXNlIHRlc3RzIHdpbGwgYmUgZXhlY3V0ZWQgZm9yIGVhY2ggdHlwZSBvZiBzdG9yZVxuLy9cbmNvbnN0IHN0b3JlVGVzdHMgPSB7XG4gICd3cml0ZUZpbGUoKS9yZWFkRmlsZSgpJyh0ZXN0OiBUZXN0LCBzdG9yZTogY2RrLklTZXNzaW9uU3RvcmUpIHtcbiAgICAvLyBXSEVOXG4gICAgc3RvcmUud3JpdGVGaWxlKCdibGEudHh0JywgJ2hlbGxvJyk7XG4gICAgc3RvcmUud3JpdGVGaWxlKCdoZXkudHh0JywgJzEyMzQnKTtcblxuICAgIC8vIFRIRU5cbiAgICB0ZXN0LmRlZXBFcXVhbChzdG9yZS5yZWFkRmlsZSgnYmxhLnR4dCcpLnRvU3RyaW5nKCksICdoZWxsbycpO1xuICAgIHRlc3QuZGVlcEVxdWFsKHN0b3JlLnJlYWRGaWxlKCdoZXkudHh0JykudG9TdHJpbmcoKSwgJzEyMzQnKTtcbiAgICB0ZXN0LnRocm93cygoKSA9PiBzdG9yZS53cml0ZUZpbGUoJ2JsYS50eHQnLCAnb3ZlcnJpZGUgaXMgZm9yYmlkZGVuJykpO1xuXG4gICAgLy8gV0hFTlxuICAgIHN0b3JlLmxvY2soKTtcblxuICAgIC8vIFRIRU5cbiAgICB0ZXN0LnRocm93cygoKSA9PiBzdG9yZS53cml0ZUZpbGUoJ2Fub3RoZXIudHh0JywgJ2xvY2tlZCEnKSk7XG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ2V4aXN0cygpIGZvciBmaWxlcycodGVzdDogVGVzdCwgc3RvcmU6IGNkay5JU2Vzc2lvblN0b3JlKSB7XG4gICAgLy8gV0hFTlxuICAgIHN0b3JlLndyaXRlRmlsZSgnQS50eHQnLCAnYWFhJyk7XG5cbiAgICAvLyBUSEVOXG4gICAgdGVzdC5vayhzdG9yZS5leGlzdHMoJ0EudHh0JykpO1xuICAgIHRlc3Qub2soIXN0b3JlLmV4aXN0cygnQi50eHQnKSk7XG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ21rZGlyJyh0ZXN0OiBUZXN0LCBzdG9yZTogY2RrLklTZXNzaW9uU3RvcmUpIHtcbiAgICAvLyBXSEVOXG4gICAgY29uc3QgZGlyMSA9IHN0b3JlLm1rZGlyKCdkaXIxJyk7XG4gICAgY29uc3QgZGlyMiA9IHN0b3JlLm1rZGlyKCdkaXIyJyk7XG5cbiAgICAvLyBUSEVOXG4gICAgdGVzdC5vayhmcy5zdGF0U3luYyhkaXIxKS5pc0RpcmVjdG9yeSgpKTtcbiAgICB0ZXN0Lm9rKGZzLnN0YXRTeW5jKGRpcjIpLmlzRGlyZWN0b3J5KCkpO1xuICAgIHRlc3QudGhyb3dzKCgpID0+IHN0b3JlLm1rZGlyKCdkaXIxJykpO1xuXG4gICAgLy8gV0hFTlxuICAgIHN0b3JlLmxvY2soKTtcbiAgICB0ZXN0LnRocm93cygoKSA9PiBzdG9yZS5ta2RpcignZGlyMycpKTtcbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnbGlzdCcodGVzdDogVGVzdCwgc3RvcmU6IGNkay5JU2Vzc2lvblN0b3JlKSB7XG4gICAgLy8gV0hFTlxuICAgIHN0b3JlLm1rZGlyKCdkaXIxJyk7XG4gICAgc3RvcmUud3JpdGVGaWxlKCdmaWxlMS50eHQnLCAnYm9vbTEnKTtcblxuICAgIC8vIFRIRU5cbiAgICB0ZXN0LmRlZXBFcXVhbChzdG9yZS5saXN0KCksIFsnZGlyMScsICdmaWxlMS50eHQnXSk7XG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ1N5bnRoZXNpc1Nlc3Npb24nKHRlc3Q6IFRlc3QsIHN0b3JlOiBjZGsuSVNlc3Npb25TdG9yZSkge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc2Vzc2lvbiA9IG5ldyBTeW50aGVzaXNTZXNzaW9uKHsgc3RvcmUgfSk7XG4gICAgY29uc3QgdGVtcGxhdGVGaWxlID0gJ2Zvby50ZW1wbGF0ZS5qc29uJztcblxuICAgIC8vIFdIRU5cbiAgICBzZXNzaW9uLmFkZEFydGlmYWN0KCdteS1maXJzdC1hcnRpZmFjdCcsIHtcbiAgICAgIHR5cGU6IGN4YXBpLkFydGlmYWN0VHlwZS5Bd3NDbG91ZEZvcm1hdGlvblN0YWNrLFxuICAgICAgZW52aXJvbm1lbnQ6ICdhd3M6Ly8xMjIyMzQ0L3VzLWVhc3QtMScsXG4gICAgICBkZXBlbmRlbmNpZXM6IFsnYScsICdiJ10sXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBmb286IHsgYmFyOiAxMjMgfVxuICAgICAgfSxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgdGVtcGxhdGVGaWxlLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgcHJvcDE6ICcxMjM0JyxcbiAgICAgICAgICBwcm9wMjogJzU1NSdcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG1pc3Npbmc6IHtcbiAgICAgICAgZm9vOiB7XG4gICAgICAgICAgcHJvdmlkZXI6ICdjb250ZXh0LXByb3ZpZGVyJyxcbiAgICAgICAgICBwcm9wczoge1xuICAgICAgICAgICAgYTogJ0EnLFxuICAgICAgICAgICAgYjogMlxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc2Vzc2lvbi5hZGRBcnRpZmFjdCgnbWluaW1hbC1hcnRpZmFjdCcsIHtcbiAgICAgIHR5cGU6IGN4YXBpLkFydGlmYWN0VHlwZS5Bd3NDbG91ZEZvcm1hdGlvblN0YWNrLFxuICAgICAgZW52aXJvbm1lbnQ6ICdhd3M6Ly8xMTEvaGVsby13b3JsZCcsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHRlbXBsYXRlRmlsZVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc2Vzc2lvbi5zdG9yZS53cml0ZUpzb24odGVtcGxhdGVGaWxlLCB7XG4gICAgICBSZXNvdXJjZXM6IHtcbiAgICAgICAgTXlUb3BpYzoge1xuICAgICAgICAgIFR5cGU6ICdBV1M6OlMzOjpUb3BpYydcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc2Vzc2lvbi5jbG9zZSgpO1xuXG4gICAgY29uc3QgbWFuaWZlc3QgPSBzZXNzaW9uLnN0b3JlLnJlYWRKc29uKGN4YXBpLk1BTklGRVNUX0ZJTEUpO1xuXG4gICAgLy8gVEhFTlxuICAgIGRlbGV0ZSBtYW5pZmVzdC5ydW50aW1lOyAvLyBkZXRlcm1pbmlzdGljIHRlc3RzXG5cbiAgICAvLyB2ZXJpZnkgdGhlIG1hbmlmZXN0IGxvb2tzIHJpZ2h0XG4gICAgdGVzdC5kZWVwRXF1YWwobWFuaWZlc3QsIHtcbiAgICAgIHZlcnNpb246IGN4YXBpLlBST1RPX1JFU1BPTlNFX1ZFUlNJT04sXG4gICAgICBhcnRpZmFjdHM6IHtcbiAgICAgICAgJ215LWZpcnN0LWFydGlmYWN0Jzoge1xuICAgICAgICAgIHR5cGU6ICdhd3M6Y2xvdWRmb3JtYXRpb246c3RhY2snLFxuICAgICAgICAgIGVudmlyb25tZW50OiAnYXdzOi8vMTIyMjM0NC91cy1lYXN0LTEnLFxuICAgICAgICAgIGRlcGVuZGVuY2llczogWydhJywgJ2InXSxcbiAgICAgICAgICBtZXRhZGF0YTogeyBmb286IHsgYmFyOiAxMjMgfSB9LFxuICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgIHRlbXBsYXRlRmlsZTogJ2Zvby50ZW1wbGF0ZS5qc29uJyxcbiAgICAgICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICAgICAgcHJvcDE6ICcxMjM0JyxcbiAgICAgICAgICAgICAgcHJvcDI6ICc1NTUnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgbWlzc2luZzoge1xuICAgICAgICAgICAgZm9vOiB7IHByb3ZpZGVyOiAnY29udGV4dC1wcm92aWRlcicsIHByb3BzOiB7IGE6ICdBJywgYjogMiB9IH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgICdtaW5pbWFsLWFydGlmYWN0Jzoge1xuICAgICAgICAgIHR5cGU6ICdhd3M6Y2xvdWRmb3JtYXRpb246c3RhY2snLFxuICAgICAgICAgIGVudmlyb25tZW50OiAnYXdzOi8vMTExL2hlbG8td29ybGQnLFxuICAgICAgICAgIHByb3BlcnRpZXM6IHsgdGVtcGxhdGVGaWxlOiAnZm9vLnRlbXBsYXRlLmpzb24nIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gdmVyaWZ5IHdlIGhhdmUgYSB0ZW1wbGF0ZSBmaWxlXG4gICAgdGVzdC5kZWVwRXF1YWwoc2Vzc2lvbi5zdG9yZS5yZWFkSnNvbih0ZW1wbGF0ZUZpbGUpLCB7XG4gICAgICBSZXNvdXJjZXM6IHtcbiAgICAgICAgTXlUb3BpYzoge1xuICAgICAgICAgIFR5cGU6ICdBV1M6OlMzOjpUb3BpYydcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ3N0YWNrLnNldFBhcmFtZXRlclZhbHVlIGNhbiBiZSB1c2VkIHRvIGFzc2lnbiBwYXJhbWV0ZXJzJyh0ZXN0OiBUZXN0KSB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBhcHAgPSBjcmVhdGVNb2Rlcm5BcHAoKTtcbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soYXBwLCAnbXktc3RhY2snKTtcbiAgICBjb25zdCBwYXJhbSA9IG5ldyBjZGsuQ2ZuUGFyYW1ldGVyKHN0YWNrLCAnTXlQYXJhbScsIHsgdHlwZTogJ3N0cmluZycgfSk7XG5cbiAgICAvLyBXSEVOXG4gICAgc3RhY2suc2V0UGFyYW1ldGVyVmFsdWUocGFyYW0sICdGb28nKTtcblxuICAgIC8vIFRIRU5cbiAgICBjb25zdCBzZXNzaW9uID0gYXBwLnJ1bigpO1xuICAgIGNvbnN0IHByb3BzID0gKHNlc3Npb24ubWFuaWZlc3QuYXJ0aWZhY3RzICYmIHNlc3Npb24ubWFuaWZlc3QuYXJ0aWZhY3RzWydteS1zdGFjayddLnByb3BlcnRpZXMpIHx8IHt9O1xuICAgIHRlc3QuZGVlcEVxdWFsKHByb3BzLnBhcmFtZXRlcnMsIHtcbiAgICAgIE15UGFyYW06ICdGb28nXG4gICAgfSk7XG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ2FkZEJ1aWxkU3RlcCBjYW4gYmUgdXNlZCB0byBwcm9kdWNlIGJ1aWxkLmpzb24nKHRlc3Q6IFRlc3QpIHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IGFwcCA9IGNyZWF0ZU1vZGVybkFwcCgpO1xuXG4gICAgLy8gV0hFTlxuICAgIGNsYXNzIEJ1aWxkTWUgZXh0ZW5kcyBjZGsuQ29uc3RydWN0IGltcGxlbWVudHMgY2RrLklTeW50aGVzaXphYmxlIHtcbiAgICAgIHB1YmxpYyBzeW50aGVzaXplKHM6IGNkay5JU3ludGhlc2lzU2Vzc2lvbikge1xuICAgICAgICBzLmFkZEJ1aWxkU3RlcCgnc3RlcF9pZCcsIHtcbiAgICAgICAgICB0eXBlOiAnYnVpbGQtc3RlcC10eXBlJyxcbiAgICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgICBib29tOiAxMjNcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIG5ldyBCdWlsZE1lKGFwcCwgJ2hleScpO1xuXG4gICAgLy8gVEhFTlxuICAgIGNvbnN0IHNlc3Npb24gID0gYXBwLnJ1bigpO1xuICAgIHRlc3QuZGVlcEVxdWFsKHNlc3Npb24uc3RvcmUubGlzdCgpLCBbICdidWlsZC5qc29uJywgJ21hbmlmZXN0Lmpzb24nIF0pO1xuICAgIHRlc3QuZGVlcEVxdWFsKHNlc3Npb24uc3RvcmUucmVhZEpzb24oJ2J1aWxkLmpzb24nKSwge1xuICAgICAgc3RlcHM6IHtcbiAgICAgICAgc3RlcF9pZDogeyB0eXBlOiAnYnVpbGQtc3RlcC10eXBlJywgcGFyYW1ldGVyczogeyBib29tOiAxMjMgfSB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGVzdC5kb25lKCk7XG4gIH1cbn07XG5cbmZvciAoY29uc3QgW25hbWUsIGZuXSBvZiBPYmplY3QuZW50cmllcyhzdG9yZVRlc3RzKSkge1xuICBjb25zdCBvdXRkaXIgPSBmcy5ta2R0ZW1wU3luYyhwYXRoLmpvaW4ob3MudG1wZGlyKCksICdzeW50aGVzaXMtdGVzdHMnKSk7XG4gIGNvbnN0IGZzU3RvcmUgPSBuZXcgRmlsZVN5c3RlbVN0b3JlKHsgb3V0ZGlyIH0pO1xuICBjb25zdCBtZW1vcnlTdG9yZSA9IG5ldyBJbk1lbW9yeVN0b3JlKCk7XG4gIHN0b3JlVGVzdE1hdHJpeFtgRmlsZVN5c3RlbVN0b3JlIC0gJHtuYW1lfWBdID0gKHRlc3Q6IFRlc3QpID0+IGZuKHRlc3QsIGZzU3RvcmUpO1xuICBzdG9yZVRlc3RNYXRyaXhbYEluTWVtb3J5U3RvcmUgLSAke25hbWV9YF0gPSAodGVzdDogVGVzdCkgPT4gZm4odGVzdCwgbWVtb3J5U3RvcmUpO1xufVxuIl19